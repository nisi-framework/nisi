function [Simulated_Temperature] = ...          simulation_system(Numerator, Denominator, ...                            Denominator_Order,Delta_t,Heat_Flux, ...                            Heat_Flux_Derivatives, plotWaitbar)%% Waitbar Definitionsif ~exist('plotWaitbar','var')    plotWaitbar = 0;end                                             %% Pre-Calculations V1 = Heat_Flux_Derivatives*(Numerator.');V2 = 1/(Denominator*(1./Delta_t.^(Denominator_Order.')));V3 = (Denominator.*(1./Delta_t.^(Denominator_Order))).';L  = length(Heat_Flux); %% Binomial Coefficient Matrix%------------------------------------------A      = zeros(L + 1,length(Denominator_Order));A(1,:) = ones(1,length(Denominator_Order));A(2,:) = (-1).* Denominator_Order;for i=2:L    A(i+1,:) = (-1).*A(i,:).*(Denominator_Order - i + 1) / i;endA = rot90(A(2:end,:),-1);A = [A zeros(size(A))];%% Waitbar DefinitionsrMrr  = 0;                  % Reduce Multiwaitbar Refresh Rateif plotWaitbar    if Heat_Flux(2,1) == 1 && sum(Heat_Flux(:,1)) == 1        nameWaitbar = 'Simulating Impulse Response';    else        nameWaitbar = 'Simulating Temperature';            end    sizeA = size(A);     if sizeA(1)*L > 100000              rMrrIncr = 0.01;        % Increment of Reduction of Multiwaitbar Refresh Rate    elseif sizeA(1)*L > 50000        rMrrIncr = 0.1;         % Increment of Reduction of Multiwaitbar Refresh Rate    elseif sizeA(1)*L > 20000        rMrrIncr = 0.33;        % Increment of Reduction of Multiwaitbar Refresh Rate    else        rMrrIncr = 1;           % Increment of Reduction of Multiwaitbar Refresh Rate    end    multiWaitbar(nameWaitbar,'Reset');end%% Simulating Temperature ResponseSimulated_Temperature  = zeros(L,1);for i=2:L    Simulated_Temperature(i) = V2.*(V1(i)- (sum(V3.*(A(:,L-i+2:2*L-i+1)* ...                               Simulated_Temperature),1)));    progress = i/L;                       % progress increases from 0 to 1  if progress > rMrr && plotWaitbar  multiWaitbar(nameWaitbar,progress);  rMrr=rMrr+rMrrIncr;                          % with kk and kkIncr the output rate is reduced  endendif plotWaitbar  multiWaitbar(nameWaitbar,1);endend           